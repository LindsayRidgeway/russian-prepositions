<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Russian Prepositions Practice App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      padding: 20px;
      background-color: #f5f5f5;
    }
    #main-container {
      display: flex;
      flex-direction: row;
      gap: 20px;
    }
    #left-panel {
      flex: 3;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #right-panel {
      flex: 1;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      max-height: 80vh;
      overflow-y: auto;
    }
    .button-group {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .mode-button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }
    .mode-button:hover {
      background-color: #45a049;
    }
    .quiz-section {
      margin-top: 20px;
    }
    .radio-option {
      margin: 6px 0;
      padding: 8px;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
    .radio-option:hover {
      background-color: #f0f0f0;
    }
    .filter-section {
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 2px solid #e0e0e0;
    }
    .filter-option {
      margin: 6px 0;
      font-size: 14px;
    }
    .reveal-section {
      margin: 15px 0;
    }
    .reveal-section button {
      background-color: #2196F3;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    .reveal-section button:hover {
      background-color: #1976D2;
    }
    .repeat-section {
      margin: 10px 0;
    }
    .repeat-section button {
      background-color: #FF9800;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }
    .repeat-section button:hover {
      background-color: #F57C00;
    }
    .submit-button {
      background-color: #9C27B0;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 15px;
      transition: background-color 0.3s;
    }
    .submit-button:hover {
      background-color: #7B1FA2;
    }
    .hidden {
      display: none;
    }
    #challenge {
      font-size: 18px;
      font-weight: bold;
      margin: 20px 0;
      padding: 15px;
      background-color: #f8f9fa;
      border-left: 4px solid #4CAF50;
      border-radius: 4px;
    }
    #result {
      margin: 15px 0;
      padding: 10px;
      border-radius: 4px;
      font-weight: bold;
    }
    .result-correct {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .result-incorrect {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    #score {
      font-size: 16px;
      font-weight: bold;
      color: #333;
      margin: 10px 0;
    }
    .filter-section h3 {
      color: #333;
      margin-bottom: 15px;
      font-size: 16px;
    }
    footer {
      margin-top: 40px;
      font-size: 0.9em;
      font-style: italic;
      text-align: center;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>Russian Prepositions Practice App</h1>

  <div id="main-container">
    <div id="left-panel">
      <div class="button-group">
        <button class="mode-button" id="btn1">English â†’ Russian</button>
        <button class="mode-button" id="btn2">Russian â†’ English</button>
        <button class="mode-button" id="btn3">ðŸ”Š Spoken English</button>
        <button class="mode-button" id="btn4">ðŸ”Š Spoken Russian</button>
      </div>

      <div class="quiz-section">
        <div id="challenge">Select filters and a quiz mode to begin</div>
        
        <div id="repeat-section" class="repeat-section hidden">
          <button id="repeat-btn">ðŸ”Š Repeat</button>
        </div>

        <div id="reveal-section" class="reveal-section hidden">
          <button id="reveal-btn">Reveal Choices</button>
        </div>

        <div id="choices-container" class="hidden">
          <div id="choices"></div>
          <div class="quiz-section">
            <button class="submit-button" id="submit-btn">Submit Answer</button>
          </div>
        </div>

        <div id="result"></div>
        <div id="score"></div>
      </div>
    </div>

    <div id="right-panel">
      <div class="filter-section">
        <h3>Frequency</h3>
        <div id="frequency-container">
          <div class="filter-option">
            <input type="checkbox" id="common" value="common" checked>
            <label for="common">More common</label>
          </div>
          <div class="filter-option">
            <input type="checkbox" id="less-common" value="less-common">
            <label for="less-common">Less common</label>
          </div>
        </div>
      </div>

      <div class="filter-section">
        <h3>Cases</h3>
        <div id="case-container">
          <div class="filter-option">
            <input type="checkbox" name="case" value="accusative" id="acc" checked>
            <label for="acc">Accusative</label>
          </div>
          <div class="filter-option">
            <input type="checkbox" name="case" value="genitive" id="gen">
            <label for="gen">Genitive</label>
          </div>
          <div class="filter-option">
            <input type="checkbox" name="case" value="dative" id="dat">
            <label for="dat">Dative</label>
          </div>
          <div class="filter-option">
            <input type="checkbox" name="case" value="instrumental" id="inst">
            <label for="inst">Instrumental</label>
          </div>
          <div class="filter-option">
            <input type="checkbox" name="case" value="prepositional" id="prep">
            <label for="prep">Prepositional</label>
          </div>
          <div class="filter-option">
            <input type="checkbox" name="case" value="nominative" id="nom">
            <label for="nom">Nominative</label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    To contact developer: <a href="mailto:LDRidgeway@gmail.com">LDRidgeway@gmail.com</a>
  </footer>

  <script>
    // Prepositions data organized by case and frequency
    const prepositionsData = {
      accusative: {
        common: [
          { english: "I'm going to the store", russian: "Ð¯ Ð¸Ð´Ñƒ Ð² Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½", preposition: "Ð²", meaning: "to/into (direction)" },
          { english: "We're walking to the park", russian: "ÐœÑ‹ Ð¸Ð´Ñ‘Ð¼ Ð² Ð¿Ð°Ñ€Ðº", preposition: "Ð²", meaning: "to/into (direction)" },
          { english: "She's looking at the cat", russian: "ÐžÐ½Ð° ÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ñ‚ Ð½Ð° ÐºÐ¾Ñ‚Ð°", preposition: "Ð½Ð°", meaning: "at/onto" },
          { english: "He's reading for an hour", russian: "ÐžÐ½ Ñ‡Ð¸Ñ‚Ð°ÐµÑ‚ Ð½Ð° Ñ‡Ð°Ñ", preposition: "Ð½Ð°", meaning: "for (time duration)" },
          { english: "I'm going to work", russian: "Ð¯ Ð¸Ð´Ñƒ Ð½Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ", preposition: "Ð½Ð°", meaning: "to (work/event)" },
          { english: "We're going through the forest", russian: "ÐœÑ‹ Ð¸Ð´Ñ‘Ð¼ Ñ‡ÐµÑ€ÐµÐ· Ð»ÐµÑ", preposition: "Ñ‡ÐµÑ€ÐµÐ·", meaning: "through/across" },
          { english: "They're walking behind the house", russian: "ÐžÐ½Ð¸ Ð¸Ð´ÑƒÑ‚ Ð·Ð° Ð´Ð¾Ð¼", preposition: "Ð·Ð°", meaning: "behind/beyond" },
          { english: "I'm putting the book under the table", russian: "Ð¯ ÐºÐ»Ð°Ð´Ñƒ ÐºÐ½Ð¸Ð³Ñƒ Ð¿Ð¾Ð´ ÑÑ‚Ð¾Ð»", preposition: "Ð¿Ð¾Ð´", meaning: "under" },
          { english: "She's going to the concert", russian: "ÐžÐ½Ð° Ð¸Ð´Ñ‘Ñ‚ Ð½Ð° ÐºÐ¾Ð½Ñ†ÐµÑ€Ñ‚", preposition: "Ð½Ð°", meaning: "to (event)" },
          { english: "We're driving to the city", russian: "ÐœÑ‹ ÐµÐ´ÐµÐ¼ Ð² Ð³Ð¾Ñ€Ð¾Ð´", preposition: "Ð²", meaning: "to/into" }
        ],
        "less-common": [
          { english: "He's walking around the building", russian: "ÐžÐ½ Ð¸Ð´Ñ‘Ñ‚ Ð²Ð¾ÐºÑ€ÑƒÐ³ Ð·Ð´Ð°Ð½Ð¸Ñ", preposition: "Ð²Ð¾ÐºÑ€ÑƒÐ³", meaning: "around" },
          { english: "I'm doing this for you", russian: "Ð¯ Ð´ÐµÐ»Ð°ÑŽ ÑÑ‚Ð¾ Ð·Ð° Ñ‚ÐµÐ±Ñ", preposition: "Ð·Ð°", meaning: "for (behalf of)" },
          { english: "She's going against the rules", russian: "ÐžÐ½Ð° Ð¸Ð´Ñ‘Ñ‚ Ð¿Ñ€Ð¾Ñ‚Ð¸Ð² Ð¿Ñ€Ð°Ð²Ð¸Ð»", preposition: "Ð¿Ñ€Ð¾Ñ‚Ð¸Ð²", meaning: "against" },
          { english: "We're walking along the river", russian: "ÐœÑ‹ Ð¸Ð´Ñ‘Ð¼ Ð²Ð´Ð¾Ð»ÑŒ Ñ€ÐµÐºÐ¸", preposition: "Ð²Ð´Ð¾Ð»ÑŒ", meaning: "along" },
          { english: "He's working despite the illness", russian: "ÐžÐ½ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½ÐµÑÐ¼Ð¾Ñ‚Ñ€Ñ Ð½Ð° Ð±Ð¾Ð»ÐµÐ·Ð½ÑŒ", preposition: "Ð½ÐµÑÐ¼Ð¾Ñ‚Ñ€Ñ Ð½Ð°", meaning: "despite" },
          { english: "I'm climbing up the mountain", russian: "Ð¯ Ð¿Ð¾Ð´Ð½Ð¸Ð¼Ð°ÑŽÑÑŒ Ð½Ð° Ð³Ð¾Ñ€Ñƒ", preposition: "Ð½Ð°", meaning: "up onto" }
        ]
      },
      genitive: {
        common: [
          { english: "I'm coming from the store", russian: "Ð¯ Ð¸Ð´Ñƒ Ð¸Ð· Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°", preposition: "Ð¸Ð·", meaning: "from/out of" },
          { english: "The book is from the library", russian: "ÐšÐ½Ð¸Ð³Ð° Ð¸Ð· Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ¸", preposition: "Ð¸Ð·", meaning: "from" },
          { english: "We're walking from the park", russian: "ÐœÑ‹ Ð¸Ð´Ñ‘Ð¼ Ð¾Ñ‚ Ð¿Ð°Ñ€ÐºÐ°", preposition: "Ð¾Ñ‚", meaning: "from/away from" },
          { english: "She's near the school", russian: "ÐžÐ½Ð° Ð¾ÐºÐ¾Ð»Ð¾ ÑˆÐºÐ¾Ð»Ñ‹", preposition: "Ð¾ÐºÐ¾Ð»Ð¾", meaning: "near/around" },
          { english: "He's standing near the house", russian: "ÐžÐ½ ÑÑ‚Ð¾Ð¸Ñ‚ Ñƒ Ð´Ð¾Ð¼Ð°", preposition: "Ñƒ", meaning: "near/by/at" },
          { english: "The cat is under the table", russian: "ÐšÐ¾Ñ‚ Ð¿Ð¾Ð´ ÑÑ‚Ð¾Ð»Ð¾Ð¼", preposition: "Ð¿Ð¾Ð´", meaning: "under" },
          { english: "I'm going without money", russian: "Ð¯ Ð¸Ð´Ñƒ Ð±ÐµÐ· Ð´ÐµÐ½ÐµÐ³", preposition: "Ð±ÐµÐ·", meaning: "without" },
          { english: "She's working until evening", russian: "ÐžÐ½Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð´Ð¾ Ð²ÐµÑ‡ÐµÑ€Ð°", preposition: "Ð´Ð¾", meaning: "until/up to" },
          { english: "We're sitting opposite the theater", russian: "ÐœÑ‹ ÑÐ¸Ð´Ð¸Ð¼ Ð½Ð°Ð¿Ñ€Ð¾Ñ‚Ð¸Ð² Ñ‚ÐµÐ°Ñ‚Ñ€Ð°", preposition: "Ð½Ð°Ð¿Ñ€Ð¾Ñ‚Ð¸Ð²", meaning: "opposite" },
          { english: "He's walking along the street", russian: "ÐžÐ½ Ð¸Ð´Ñ‘Ñ‚ Ð¿Ð¾ ÑƒÐ»Ð¸Ñ†Ðµ", preposition: "Ð¿Ð¾", meaning: "along/down" }
        ],
        "less-common": [
          { english: "I'm going instead of my brother", russian: "Ð¯ Ð¸Ð´Ñƒ Ð²Ð¼ÐµÑÑ‚Ð¾ Ð±Ñ€Ð°Ñ‚Ð°", preposition: "Ð²Ð¼ÐµÑÑ‚Ð¾", meaning: "instead of" },
          { english: "She's working because of the need", russian: "ÐžÐ½Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð¸Ð·-Ð·Ð° Ð½ÑƒÐ¶Ð´Ñ‹", preposition: "Ð¸Ð·-Ð·Ð°", meaning: "because of" },
          { english: "We're sitting around the table", russian: "ÐœÑ‹ ÑÐ¸Ð´Ð¸Ð¼ Ð²Ð¾ÐºÑ€ÑƒÐ³ ÑÑ‚Ð¾Ð»Ð°", preposition: "Ð²Ð¾ÐºÑ€ÑƒÐ³", meaning: "around" },
          { english: "He's reading during the break", russian: "ÐžÐ½ Ñ‡Ð¸Ñ‚Ð°ÐµÑ‚ Ð²Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð¿ÐµÑ€ÐµÑ€Ñ‹Ð²Ð°", preposition: "Ð²Ð¾ Ð²Ñ€ÐµÐ¼Ñ", meaning: "during" },
          { english: "I'm working for the sake of family", russian: "Ð¯ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽ Ñ€Ð°Ð´Ð¸ ÑÐµÐ¼ÑŒÐ¸", preposition: "Ñ€Ð°Ð´Ð¸", meaning: "for the sake of" },
          { english: "She's coming from the side of the forest", russian: "ÐžÐ½Ð° Ð¸Ð´Ñ‘Ñ‚ ÑÐ¾ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñ‹ Ð»ÐµÑÐ°", preposition: "ÑÐ¾ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñ‹", meaning: "from the direction of" }
        ]
      },
      dative: {
        common: [
          { english: "I'm going to my friend", russian: "Ð¯ Ð¸Ð´Ñƒ Ðº Ð´Ñ€ÑƒÐ³Ñƒ", preposition: "Ðº", meaning: "to/toward (person)" },
          { english: "We're walking toward the river", russian: "ÐœÑ‹ Ð¸Ð´Ñ‘Ð¼ Ðº Ñ€ÐµÐºÐµ", preposition: "Ðº", meaning: "toward" },
          { english: "She's walking along the path", russian: "ÐžÐ½Ð° Ð¸Ð´Ñ‘Ñ‚ Ð¿Ð¾ Ð´Ð¾Ñ€Ð¾Ð³Ðµ", preposition: "Ð¿Ð¾", meaning: "along/down" },
          { english: "He's distributed by age", russian: "ÐžÐ½ Ñ€Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½ Ð¿Ð¾ Ð²Ð¾Ð·Ñ€Ð°ÑÑ‚Ñƒ", preposition: "Ð¿Ð¾", meaning: "by/according to" },
          { english: "I'm studying Russian", russian: "Ð¯ Ð¸Ð·ÑƒÑ‡Ð°ÑŽ Ñ€ÑƒÑÑÐºÐ¸Ð¹", preposition: "Ð¿Ð¾", meaning: "subject of study" },
          { english: "We're going to the doctor", russian: "ÐœÑ‹ Ð¸Ð´Ñ‘Ð¼ Ðº Ð²Ñ€Ð°Ñ‡Ñƒ", preposition: "Ðº", meaning: "to (person)" },
          { english: "She's walking toward the forest", russian: "ÐžÐ½Ð° Ð¸Ð´Ñ‘Ñ‚ Ðº Ð»ÐµÑÑƒ", preposition: "Ðº", meaning: "toward" },
          { english: "He's hitting the ball", russian: "ÐžÐ½ Ð±ÑŒÑ‘Ñ‚ Ð¿Ð¾ Ð¼ÑÑ‡Ñƒ", preposition: "Ð¿Ð¾", meaning: "at/on (striking)" }
        ],
        "less-common": [
          { english: "I'm going according to the schedule", russian: "Ð¯ Ð¸Ð´Ñƒ ÑÐ¾Ð³Ð»Ð°ÑÐ½Ð¾ Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸ÑŽ", preposition: "ÑÐ¾Ð³Ð»Ð°ÑÐ½Ð¾", meaning: "according to" },
          { english: "We're approaching the deadline", russian: "ÐœÑ‹ Ð¿Ñ€Ð¸Ð±Ð»Ð¸Ð¶Ð°ÐµÐ¼ÑÑ Ðº ÑÑ€Ð¾ÐºÑƒ", preposition: "Ðº", meaning: "toward (time)" },
          { english: "She's going contrary to advice", russian: "ÐžÐ½Ð° Ð¸Ð´Ñ‘Ñ‚ Ð²Ð¾Ð¿Ñ€ÐµÐºÐ¸ ÑÐ¾Ð²ÐµÑ‚Ñƒ", preposition: "Ð²Ð¾Ð¿Ñ€ÐµÐºÐ¸", meaning: "contrary to" },
          { english: "He's walking thanks to help", russian: "ÐžÐ½ Ð¸Ð´Ñ‘Ñ‚ Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸", preposition: "Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ñ", meaning: "thanks to" }
        ]
      },
      instrumental: {
        common: [
          { english: "I'm writing with a pen", russian: "Ð¯ Ð¿Ð¸ÑˆÑƒ Ñ€ÑƒÑ‡ÐºÐ¾Ð¹", preposition: "", meaning: "with (instrument)" },
          { english: "We're going with friends", russian: "ÐœÑ‹ Ð¸Ð´Ñ‘Ð¼ Ñ Ð´Ñ€ÑƒÐ·ÑŒÑÐ¼Ð¸", preposition: "Ñ", meaning: "with (together)" },
          { english: "She's standing behind the tree", russian: "ÐžÐ½Ð° ÑÑ‚Ð¾Ð¸Ñ‚ Ð·Ð° Ð´ÐµÑ€ÐµÐ²Ð¾Ð¼", preposition: "Ð·Ð°", meaning: "behind" },
          { english: "He's walking under the bridge", russian: "ÐžÐ½ Ð¸Ð´Ñ‘Ñ‚ Ð¿Ð¾Ð´ Ð¼Ð¾ÑÑ‚Ð¾Ð¼", preposition: "Ð¿Ð¾Ð´", meaning: "under" },
          { english: "I'm sitting between the windows", russian: "Ð¯ ÑÐ¸Ð¶Ñƒ Ð¼ÐµÐ¶Ð´Ñƒ Ð¾ÐºÐ½Ð°Ð¼Ð¸", preposition: "Ð¼ÐµÐ¶Ð´Ñƒ", meaning: "between" },
          { english: "We're standing before the building", russian: "ÐœÑ‹ ÑÑ‚Ð¾Ð¸Ð¼ Ð¿ÐµÑ€ÐµÐ´ Ð·Ð´Ð°Ð½Ð¸ÐµÐ¼", preposition: "Ð¿ÐµÑ€ÐµÐ´", meaning: "in front of/before" },
          { english: "She's walking above the clouds", russian: "ÐžÐ½Ð° Ð»ÐµÑ‚Ð¸Ñ‚ Ð½Ð°Ð´ Ð¾Ð±Ð»Ð°ÐºÐ°Ð¼Ð¸", preposition: "Ð½Ð°Ð´", meaning: "above/over" }
        ],
        "less-common": [
          { english: "I'm satisfied with the result", russian: "Ð¯ Ð´Ð¾Ð²Ð¾Ð»ÐµÐ½ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð¼", preposition: "", meaning: "with (satisfaction)" },
          { english: "We're connected with the past", russian: "ÐœÑ‹ ÑÐ²ÑÐ·Ð°Ð½Ñ‹ Ñ Ð¿Ñ€Ð¾ÑˆÐ»Ñ‹Ð¼", preposition: "Ñ", meaning: "with (connection)" },
          { english: "He's busy with work", russian: "ÐžÐ½ Ð·Ð°Ð½ÑÑ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð¾Ð¹", preposition: "", meaning: "with (occupied)" },
          { english: "She's walking along with her sister", russian: "ÐžÐ½Ð° Ð¸Ð´Ñ‘Ñ‚ Ð²Ð¼ÐµÑÑ‚Ðµ Ñ ÑÐµÑÑ‚Ñ€Ð¾Ð¹", preposition: "Ð²Ð¼ÐµÑÑ‚Ðµ Ñ", meaning: "together with" }
        ]
      },
      prepositional: {
        common: [
          { english: "I'm sitting in the room", russian: "Ð¯ ÑÐ¸Ð¶Ñƒ Ð² ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ðµ", preposition: "Ð²", meaning: "in (location)" },
          { english: "The book is on the table", russian: "ÐšÐ½Ð¸Ð³Ð° Ð½Ð° ÑÑ‚Ð¾Ð»Ðµ", preposition: "Ð½Ð°", meaning: "on (surface)" },
          { english: "We're talking about the movie", russian: "ÐœÑ‹ Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ð¼ Ð¾ Ñ„Ð¸Ð»ÑŒÐ¼Ðµ", preposition: "Ð¾", meaning: "about" },
          { english: "She's working at the factory", russian: "ÐžÐ½Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½Ð° Ð·Ð°Ð²Ð¾Ð´Ðµ", preposition: "Ð½Ð°", meaning: "at (workplace)" },
          { english: "He's studying at the university", russian: "ÐžÐ½ ÑƒÑ‡Ð¸Ñ‚ÑÑ Ð² ÑƒÐ½Ð¸Ð²ÐµÑ€ÑÐ¸Ñ‚ÐµÑ‚Ðµ", preposition: "Ð²", meaning: "at (institution)" },
          { english: "I'm thinking about the problem", russian: "Ð¯ Ð´ÑƒÐ¼Ð°ÑŽ Ð¾ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ðµ", preposition: "Ð¾", meaning: "about" },
          { english: "We're standing at the station", russian: "ÐœÑ‹ ÑÑ‚Ð¾Ð¸Ð¼ Ð½Ð° ÑÑ‚Ð°Ð½Ñ†Ð¸Ð¸", preposition: "Ð½Ð°", meaning: "at (transport hub)" },
          { english: "She's sitting in the car", russian: "ÐžÐ½Ð° ÑÐ¸Ð´Ð¸Ñ‚ Ð² Ð¼Ð°ÑˆÐ¸Ð½Ðµ", preposition: "Ð²", meaning: "in (vehicle)" }
        ],
        "less-common": [
          { english: "I'm dreaming about vacation", russian: "Ð¯ Ð¼ÐµÑ‡Ñ‚Ð°ÑŽ Ð¾Ð± Ð¾Ñ‚Ð¿ÑƒÑÐºÐµ", preposition: "Ð¾", meaning: "about (dreams)" },
          { english: "We're talking about the weather", russian: "ÐœÑ‹ Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ð¼ Ð¾ Ð¿Ð¾Ð³Ð¾Ð´Ðµ", preposition: "Ð¾", meaning: "about (topic)" },
          { english: "He's working upon request", russian: "ÐžÐ½ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð¿Ð¾ Ð¿Ñ€Ð¾ÑÑŒÐ±Ðµ", preposition: "Ð¿Ð¾", meaning: "upon/at" },
          { english: "She's located at the edge", russian: "ÐžÐ½Ð° Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð¿Ñ€Ð¸ ÐºÑ€Ð°Ðµ", preposition: "Ð¿Ñ€Ð¸", meaning: "at/by/near" }
        ]
      },
      nominative: {
        common: [],
        "less-common": [
          { english: "I walk like a soldier", russian: "Ð¯ Ñ…Ð¾Ð¶Ñƒ ÐºÐ°Ðº ÑÐ¾Ð»Ð´Ð°Ñ‚", preposition: "ÐºÐ°Ðº", meaning: "like/as" }
        ]
      }
    };

    // App state
    let currentCorrectAnswer = null;
    let currentRound = [];
    let currentIndex = 0;
    let score = 0;
    let currentMode = "en-to-ru";
    let currentChallengeText = "";
    let currentLanguage = "en-US";

    // Speech synthesis
    function speak(text, lang = "en-US") {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = lang;
      utterance.rate = 0.9;
      speechSynthesis.speak(utterance);
    }

    // Filter functions
    function getSelectedFrequencies() {
      const checkboxes = document.querySelectorAll('#frequency-container input[type="checkbox"]:checked');
      return Array.from(checkboxes).map(cb => cb.value);
    }

    function getSelectedCases() {
      const checkboxes = document.querySelectorAll('#case-container input[type="checkbox"]:checked');
      return Array.from(checkboxes).map(cb => cb.value);
    }

    // Data flattening function
    function flattenPrepositionsData(selectedFrequencies, selectedCases) {
      let flatData = [];
      
      selectedCases.forEach(caseName => {
        if (prepositionsData[caseName]) {
          selectedFrequencies.forEach(frequency => {
            if (prepositionsData[caseName][frequency]) {
              prepositionsData[caseName][frequency].forEach(item => {
                flatData.push({
                  case: caseName,
                  frequency: frequency,
                  english: item.english,
                  russian: item.russian,
                  preposition: item.preposition,
                  meaning: item.meaning
                });
              });
            }
          });
        }
      });
      
      return flatData;
    }

    // Utility functions
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function hideAllQuizElements() {
      document.getElementById('reveal-section').classList.add('hidden');
      document.getElementById('choices-container').classList.add('hidden');
      document.getElementById('repeat-section').classList.add('hidden');
      document.getElementById('result').innerText = '';
      document.getElementById('score').innerText = '';
    }

    // Main quiz logic
    function startNewRound(mode) {
      const selectedFrequencies = getSelectedFrequencies();
      const selectedCases = getSelectedCases();
      
      if (selectedFrequencies.length === 0) {
        document.getElementById('challenge').innerText = 'Please select at least one frequency level.';
        hideAllQuizElements();
        return;
      }
      
      if (selectedCases.length === 0) {
        document.getElementById('challenge').innerText = 'Please select at least one case.';
        hideAllQuizElements();
        return;
      }

      const availableData = flattenPrepositionsData(selectedFrequencies, selectedCases);

      if (availableData.length < 3) {
        document.getElementById('challenge').innerText = `Not enough data for selected filters. Found ${availableData.length} items, need at least 3.`;
        hideAllQuizElements();
        return;
      }

      currentMode = mode;
      score = 0;
      currentIndex = 0;
      document.getElementById('result').innerText = '';
      document.getElementById('score').innerText = 'Score: 0 for 0';

      shuffleArray(availableData);
      currentRound = availableData.slice(0, Math.min(10, availableData.length));
      showCurrentChallenge();
    }

    function showCurrentChallenge() {
      const challenge = currentRound[currentIndex];
      const selectedFrequencies = getSelectedFrequencies();
      const selectedCases = getSelectedCases();
      const allOptions = flattenPrepositionsData(selectedFrequencies, selectedCases);
      
      let challengeText, correct, wrongField, lang;

      if (currentMode === "en-to-ru" || currentMode === "spoken-en-to-ru") {
        challengeText = challenge.english;
        correct = challenge.russian;
        wrongField = "russian";
        lang = "en-US";
      } else {
        challengeText = challenge.russian;
        correct = challenge.english;
        wrongField = "english";
        lang = "ru-RU";
      }

      currentCorrectAnswer = correct;
      currentChallengeText = challengeText;
      currentLanguage = lang;
      document.getElementById('result').innerText = '';

      // Hide choices initially
      document.getElementById('choices-container').classList.add('hidden');
      document.getElementById('reveal-section').classList.remove('hidden');

      if (currentMode.startsWith("spoken")) {
        document.getElementById('challenge').innerText = 'ðŸ”Š Listen carefully...';
        document.getElementById('repeat-section').classList.remove('hidden');
        speak(challengeText, lang);
      } else {
        document.getElementById('challenge').innerText = challengeText;
        document.getElementById('repeat-section').classList.add('hidden');
      }

      // Prepare choices
      const decoys = allOptions
        .filter(item => item[wrongField] !== correct)
        .map(item => item[wrongField]);
      
      shuffleArray(decoys);

      const choices = [...decoys.slice(0, Math.min(allOptions.length - 1, 9)), correct];
      shuffleArray(choices);

      const choicesEl = document.getElementById('choices');
      choicesEl.innerHTML = '';
      choices.forEach((choice, index) => {
        const div = document.createElement('div');
        div.className = 'radio-option';
        div.innerHTML = `<input type="radio" name="answer" value="${choice}" id="opt${index}"> <label for="opt${index}">${choice}</label>`;
        choicesEl.appendChild(div);
      });
    }

    // Event listeners
    document.getElementById('btn1').addEventListener('click', () => {
      startNewRound("en-to-ru");
    });

    document.getElementById('btn2').addEventListener('click', () => {
      startNewRound("ru-to-en");
    });

    document.getElementById('btn3').addEventListener('click', () => {
      startNewRound("spoken-en-to-ru");
    });

    document.getElementById('btn4').addEventListener('click', () => {
      startNewRound("spoken-ru-to-en");
    });

    document.getElementById('reveal-btn').addEventListener('click', () => {
      document.getElementById('reveal-section').classList.add('hidden');
      document.getElementById('choices-container').classList.remove('hidden');
    });

    document.getElementById('repeat-btn').addEventListener('click', () => {
      speak(currentChallengeText, currentLanguage);
    });

    document.getElementById('submit-btn').addEventListener('click', () => {
      const selected = document.querySelector('input[name="answer"]:checked');
      const resultEl = document.getElementById('result');
      
      if (!selected) {
        resultEl.innerText = 'Please select an answer.';
        resultEl.className = '';
        return;
      }

      if (selected.value === currentCorrectAnswer) {
        score++;
        resultEl.innerText = 'Correct!';
        resultEl.className = 'result-correct';
      } else {
        resultEl.innerText = `Incorrect. Correct answer: ${currentCorrectAnswer}`;
        resultEl.className = 'result-incorrect';
      }

      document.getElementById('score').innerText = `Score: ${score} for ${currentIndex + 1}`;

      currentIndex++;
      if (currentIndex < currentRound.length) {
        setTimeout(showCurrentChallenge, 2000);
      } else {
        setTimeout(() => {
          document.getElementById('challenge').innerText = `Round complete! Final score: ${score}/${currentRound.length}`;
          document.getElementById('reveal-section').classList.add('hidden');
          document.getElementById('choices-container').classList.add('hidden');
          document.getElementById('repeat-section').classList.add('hidden');
          document.getElementById('result').innerText = '';
          // Keep scoreEl visible - don't clear it
        }, 2000);
      }
    });
  </script>
  <script data-goatcounter="https://russian-prepositions.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script></body>
</html>